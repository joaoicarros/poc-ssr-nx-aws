version: 1
applications:
  - appRoot: apps/poc-ssr
    frontend:
      phases:
        preBuild:
          commands:
            - echo 'change config amplifyConfig '
            - cd ../../
            - pwd
            - npm install -g nx
            - npm install
        build:
          commands:
            - echo 'npx nx build'
            - npx nx build poc-ssr
            - cd apps/poc-ssr
            - echo 'start install in folder apps/poc-ssr'
            - npm install
            - echo 'finish build'
      artifacts:
        baseDirectory: ../../dist/apps/poc-ssr/.next
        files:
          - '**/*'
        discard-paths: yes
      cache:
        paths:
          - ../../node_modules/**/*
          - ../../dist/apps/poc-ssr/.next/cache/**/*
