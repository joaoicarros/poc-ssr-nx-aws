version: 1
applications:
  - appRoot: apps/poc-ssr
    frontend:
      phases:
        preBuild:
          commands:
            - echo 'change config amplifyConfig '
            - cd ../../
            - pwd
            - npm install -g nx
            - npm install
        build:
          commands:
            - echo 'npx nx build and comment'
            - npx nx build poc-ssr
            # This step will build/update SSR resources(S3, Cloudfront, Lambda@Edge)
            # - cd apps/poc-ssr
            # - npm install
      artifacts:
        baseDirectory: ../../dist/apps/poc-ssr/.next
        files:
          - '**/*'
        discard-paths: yes
      cache:
        paths:
          - ../../node_modules/**/*
          - ../../dist/apps/poc-ssr/.next/cache/**/*
